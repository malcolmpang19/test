name: CI/CD Pipeline for Main Branch

on:
  push:
    branches:
      - main

jobs:
  ci-pipeline:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Check out the code
      - name: Check out the repository
        uses: actions/checkout@v3
      
      # Step 2: Run Super Linter
      #- name: Run Super Linter
      #  uses: github/super-linter@v5
      #  continue-on-error: true
      #  env:
      #    DEFAULT_BRANCH: main
      #    VALIDATE_ALL_CODEBASE: true
      #    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    # Step 2: Lint HTML, CSS, and JavaScript
      - name: Lint HTML, CSS, and JavaScript
        run: |
          sudo apt-get update
          sudo apt-get install tidy -y  # HTML linter
          npm install -g stylelint stylelint-config-standard  # CSS linter
          npm install -g jshint  # JS linter

          find . -name "*.html" -exec tidy -q -e {} \; || true
          stylelint "**/*.css" --config standard || true
          jshint **/*.js || true
          
  update-repo:
    runs-on: self-hosted

    steps:
      # Step 7: Check out the repository
      - name: Check out the repository
        uses: actions/checkout@v3

      # Step 8: Set correct permissions for the repository on the server
      - name: Set correct permissions for the repository
        run: |
          sudo chown -R $(whoami):$(whoami) /var/www/html/test
          sudo chmod -R u+rw /var/www/html/test

      # Step 9: Push updates to the RHEL server repository
      - name: Push updates to the RHEL server
        run: |
          cd /var/www/html/test
          git fetch origin main
          git reset --hard origin/main
          echo "Repository updated on the server."
